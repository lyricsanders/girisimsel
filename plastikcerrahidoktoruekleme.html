<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plastik Cerrahi Doktoru Ekleme</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #f0f4f8, #e2e8f0);
            color: #333;
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ccc;
        }
        th {
            background-color: #4a4e52;
            color: white;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        .action-buttons button {
            background: none;
            border: none;
            cursor: pointer;
            color: #4a4e52;
            font-size: 1.1em;
        }
        .input-section {
            margin-bottom: 20px;
            text-align: center;
        }
        .input-section input[type="text"] {
            padding: 10px;
            width: 40%;
            margin-right: 10px;
        }
        .save-order {
            margin-top: 20px;
            text-align: center;
        }
        .save-order button {
            padding: 10px 20px;
            background-color: #4a4e52;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <h1>Plastik Cerrahi Doktoru Ekleme</h1>

    <div class="input-section">
        <input type="text" id="doctorName" placeholder="Doktor Adı Soyadı">
        <button onclick="addDoctor()">Kaydet</button>
    </div>

    <table id="doctorTable">
        <thead>
            <tr>
                <th style="width: 2%;">#</th>
                <th style="width: 30%;">Plastik Cerrahi Doktoru</th>
                <th style="width: 10%;">İşlemler</th>
            </tr>
        </thead>
        <tbody id="doctorTableBody">
            <!-- Dinamik olarak satırlar buraya eklenecek -->
        </tbody>
    </table>

    <div class="save-order">
        <button onclick="saveOrder()">Sıralamayı Kaydet</button>
    </div>

    <script>
        let db;
        const request = indexedDB.open("doctorsDB", 1);

        request.onerror = function(event) {
            console.error("Database error: " + event.target.errorCode);
        };

        request.onupgradeneeded = function(event) {
            db = event.target.result;
            const objectStore = db.createObjectStore("doctors", { keyPath: "id", autoIncrement: true });
            objectStore.createIndex("name", "name", { unique: false });
            objectStore.createIndex("order", "order", { unique: false }); // Sıra için indeks
        };

        request.onsuccess = function(event) {
            db = event.target.result;
            loadDoctors(); // Sayfa açıldığında doktorları yükle
        };

        function loadDoctors() {
            const transaction = db.transaction(["doctors"], "readonly");
            const objectStore = transaction.objectStore("doctors");
            const request = objectStore.index("order").getAll(); // Sıralamaya göre yükle

            request.onsuccess = function(event) {
                const doctors = event.target.result;
                doctors.forEach(doctor => {
                    addTableRow(doctor.id, doctor.name);
                });
            };
        }

        function addDoctor() {
            const name = document.getElementById("doctorName").value;
            if (name) {
                const transaction = db.transaction(["doctors"], "readwrite");
                const objectStore = transaction.objectStore("doctors");
                const doctor = { name: name, order: Date.now() }; // Sıra için zaman damgası ekle

                const request = objectStore.add(doctor);
                request.onsuccess = function() {
                    addTableRow(request.result, name);
                    document.getElementById("doctorName").value = ""; // Girişi temizle
                };

                request.onerror = function(event) {
                    console.error("Error adding doctor: " + event.target.error);
                };
            } else {
                alert("Lütfen bir doktor adı girin.");
            }
        }

        function addTableRow(id, name) {
            const tableBody = document.getElementById("doctorTableBody");
            const row = document.createElement("tr");
            row.dataset.id = id; // Satıra id ekle

            row.innerHTML = `
                <td>
                    <button onclick="moveRow(this, 'up')"><i class="fas fa-arrow-up"></i></button>
                    <button onclick="moveRow(this, 'down')"><i class="fas fa-arrow-down"></i></button>
                </td>
                <td>${name}</td>
                <td class="action-buttons">
                    <button onclick="editDoctor(${id}, '${name}')">Düzenle</button>
                    <button onclick="deleteDoctor(${id}, this)">Sil</button>
                </td>
            `;
            tableBody.appendChild(row);
        }

        function moveRow(button, direction) {
            const row = button.closest("tr");
            const tableBody = document.getElementById("doctorTableBody");

            if (direction === 'up' && row.previousElementSibling) {
                tableBody.insertBefore(row, row.previousElementSibling);
            } else if (direction === 'down' && row.nextElementSibling) {
                tableBody.insertBefore(row.nextElementSibling, row);
            }
        }

        function editDoctor(id, oldName) {
            const newName = prompt("Doktor adını düzenleyin:", oldName);
            if (newName) {
                const transaction = db.transaction(["doctors"], "readwrite");
                const objectStore = transaction.objectStore("doctors");
                const request = objectStore.get(id);

                request.onsuccess = function(event) {
                    const doctor = event.target.result;
                    doctor.name = newName; // Yeni adı ata
                    objectStore.put(doctor); // Güncelle
                    loadDoctors(); // Güncellemeleri yükle
                };
            }
        }

        function deleteDoctor(id, button) {
            const transaction = db.transaction(["doctors"], "readwrite");
            const objectStore = transaction.objectStore("doctors");
            objectStore.delete(id); // Sil

            const row = button.closest("tr");
            row.remove(); // Tablo satırını kaldır
        }

        function saveOrder() {
            const rows = document.querySelectorAll("#doctorTableBody tr");
            const newOrder = [];

            rows.forEach((row, index) => {
                newOrder.push({ id: parseInt(row.dataset.id), name: row.cells[1].textContent, order: index }); // Sıra bilgisini ekle
            });

            const transaction = db.transaction(["doctors"], "readwrite");
            const objectStore = transaction.objectStore("doctors");

            const promises = newOrder.map(doctor => {
                return new Promise((resolve, reject) => {
                    const request = objectStore.put({ id: doctor.id, name: doctor.name, order: doctor.order }); // Yeni sırayı güncelle
                    request.onsuccess = resolve;
                    request.onerror = reject;
                });
            });

            Promise.all(promises)
                .then(() => {
                    alert("Sıralama kaydedildi!");
                })
                .catch(err => {
                    console.error("Error saving order: " + err);
                });
        }
    </script>
</body>
</html>
